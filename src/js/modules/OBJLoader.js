THREE.OBJLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null,this.regexp={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}},THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(e,t,r,a){var i=this,s=new THREE.FileLoader(i.manager);s.setPath(this.path),s.load(e,function(e){t(i.parse(e))},r,a)},setPath:function(e){this.path=e},setMaterials:function(e){this.materials=e},_createParserState:function(){var e={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var a={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(a),a},currentMaterial:function(){return this.materials.length>0?this.materials[this.materials.length-1]:void 0},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){var a=r.clone(0);a.inherited=!0,this.object.materials.push(a)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){var a=this.vertices,i=this.object.geometry.vertices;i.push(a[e+0]),i.push(a[e+1]),i.push(a[e+2]),i.push(a[t+0]),i.push(a[t+1]),i.push(a[t+2]),i.push(a[r+0]),i.push(a[r+1]),i.push(a[r+2])},addVertexLine:function(e){var t=this.vertices,r=this.object.geometry.vertices;r.push(t[e+0]),r.push(t[e+1]),r.push(t[e+2])},addNormal:function(e,t,r){var a=this.normals,i=this.object.geometry.normals;i.push(a[e+0]),i.push(a[e+1]),i.push(a[e+2]),i.push(a[t+0]),i.push(a[t+1]),i.push(a[t+2]),i.push(a[r+0]),i.push(a[r+1]),i.push(a[r+2])},addUV:function(e,t,r){var a=this.uvs,i=this.object.geometry.uvs;i.push(a[e+0]),i.push(a[e+1]),i.push(a[t+0]),i.push(a[t+1]),i.push(a[r+0]),i.push(a[r+1])},addUVLine:function(e){var t=this.uvs,r=this.object.geometry.uvs;r.push(t[e+0]),r.push(t[e+1])},addFace:function(e,t,r,a,i,s,n,o,h,l,u,d){var v,f=this.vertices.length,c=this.parseVertexIndex(e,f),p=this.parseVertexIndex(t,f),m=this.parseVertexIndex(r,f);if(void 0===a?this.addVertex(c,p,m):(v=this.parseVertexIndex(a,f),this.addVertex(c,p,v),this.addVertex(p,m,v)),void 0!==i){var g=this.uvs.length;c=this.parseUVIndex(i,g),p=this.parseUVIndex(s,g),m=this.parseUVIndex(n,g),void 0===a?this.addUV(c,p,m):(v=this.parseUVIndex(o,g),this.addUV(c,p,v),this.addUV(p,m,v))}if(void 0!==h){var x=this.normals.length;c=this.parseNormalIndex(h,x),p=h===l?c:this.parseNormalIndex(l,x),m=h===u?c:this.parseNormalIndex(u,x),void 0===a?this.addNormal(c,p,m):(v=this.parseNormalIndex(d,x),this.addNormal(c,p,v),this.addNormal(p,m,v))}},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,a=this.uvs.length,i=0,s=e.length;s>i;i++)this.addVertexLine(this.parseVertexIndex(e[i],r));for(var n=0,s=t.length;s>n;n++)this.addUVLine(this.parseUVIndex(t[n],a))}};return e.startObject("",!1),e},parse:function(e){console.time("OBJLoader");var t=this._createParserState();-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));for(var r=e.split("\n"),a="",i="",s="",n=0,o=[],h="function"==typeof"".trimLeft,l=0,u=r.length;u>l;l++)if(a=r[l],a=h?a.trimLeft():a.trim(),n=a.length,0!==n&&(i=a.charAt(0),"#"!==i))if("v"===i)if(s=a.charAt(1)," "===s&&null!==(o=this.regexp.vertex_pattern.exec(a)))t.vertices.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else if("n"===s&&null!==(o=this.regexp.normal_pattern.exec(a)))t.normals.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else{if("t"!==s||null===(o=this.regexp.uv_pattern.exec(a)))throw new Error("Unexpected vertex/normal/uv line: '"+a+"'");t.uvs.push(parseFloat(o[1]),parseFloat(o[2]))}else if("f"===i)if(null!==(o=this.regexp.face_vertex_uv_normal.exec(a)))t.addFace(o[1],o[4],o[7],o[10],o[2],o[5],o[8],o[11],o[3],o[6],o[9],o[12]);else if(null!==(o=this.regexp.face_vertex_uv.exec(a)))t.addFace(o[1],o[3],o[5],o[7],o[2],o[4],o[6],o[8]);else if(null!==(o=this.regexp.face_vertex_normal.exec(a)))t.addFace(o[1],o[3],o[5],o[7],void 0,void 0,void 0,void 0,o[2],o[4],o[6],o[8]);else{if(null===(o=this.regexp.face_vertex.exec(a)))throw new Error("Unexpected face line: '"+a+"'");t.addFace(o[1],o[2],o[3],o[4])}else if("l"===i){var d=a.substring(1).trim().split(" "),f=[],c=[];if(-1===a.indexOf("/"))f=d;else for(var p=0,m=d.length;m>p;p++){var v=d[p].split("/");""!==v[0]&&f.push(v[0]),""!==v[1]&&c.push(v[1])}t.addLineGeometry(f,c)}else if(null!==(o=this.regexp.object_pattern.exec(a))){var g=(" "+o[0].substr(1).trim()).substr(1);t.startObject(g)}else if(this.regexp.material_use_pattern.test(a))t.object.startMaterial(a.substring(7).trim(),t.materialLibraries);else if(this.regexp.material_library_pattern.test(a))t.materialLibraries.push(a.substring(7).trim());else{if(null===(o=this.regexp.smoothing_pattern.exec(a))){if("\x00"===a)continue;throw new Error("Unexpected line: '"+a+"'")}var x=o[1].trim().toLowerCase();t.object.smooth="1"===x||"on"===x;var b=t.object.currentMaterial();b&&(b.smooth=t.object.smooth)}t.finalize();var E=new THREE.Group;E.materialLibraries=[].concat(t.materialLibraries);for(var l=0,u=t.objects.length;u>l;l++){var _=t.objects[l],j=_.geometry,y=_.materials,L="Line"===j.type;if(0!==j.vertices.length){var V=new THREE.BufferGeometry;V.addAttribute("position",new THREE.BufferAttribute(new Float32Array(j.vertices),3)),j.normals.length>0?V.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(j.normals),3)):V.computeVertexNormals(),j.uvs.length>0&&V.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(j.uvs),2));for(var w=[],H=0,R=y.length;R>H;H++){var T=y[H],b=void 0;if(null!==this.materials&&(b=this.materials.create(T.name),L&&b&&!(b instanceof THREE.LineBasicMaterial))){var I=new THREE.LineBasicMaterial;I.copy(b),b=I}b||(b=L?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial,b.name=T.name),b.shading=T.smooth?THREE.SmoothShading:THREE.FlatShading,w.push(b)}var F;if(w.length>1){for(var H=0,R=y.length;R>H;H++){var T=y[H];V.addGroup(T.groupStart,T.groupCount,H)}var M=new THREE.MultiMaterial(w);F=L?new THREE.LineSegments(V,M):new THREE.Mesh(V,M)}else F=L?new THREE.LineSegments(V,w[0]):new THREE.Mesh(V,w[0]);F.name=_.name,E.add(F)}}return console.timeEnd("OBJLoader"),E}};